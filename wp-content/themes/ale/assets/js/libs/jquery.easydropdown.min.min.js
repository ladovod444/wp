(function(c){function b(){this.isField=!0;this.keyboardMode=this.hasLabel=this.cutOff=this.disabled=this.inFocus=this.down=!1;this.nativeTouch=!0;this.wrapperClass="dropdown";this.onChange=null}b.prototype={constructor:b,instances:{},init:function(e,f){var d=this;c.extend(d,f);d.$select=c(e);d.id=e.id;d.options=[];d.$options=d.$select.find("option");d.isTouch="ontouchend" in document;d.$select.removeClass(d.wrapperClass+" dropdown");d.$select.is(":disabled")&&(d.disabled=!0);d.$options.length&&(d.$options.each(function(g){var h=c(this);h.is(":selected")&&(d.selected={index:g,title:h.text()},d.focusIndex=g);h.hasClass("label")&&0==g?(d.hasLabel=!0,d.label=h.text(),h.attr("value","")):d.options.push({domNode:h[0],title:h.text(),value:h.val(),selected:h.is(":selected")})}),d.selected||(d.selected={index:0,title:d.$options.eq(0).text()},d.focusIndex=0),d.render())},render:function(){var d=this;d.$container=d.$select.wrap('<div class="'+d.wrapperClass+(d.isTouch&&d.nativeTouch?" touch":"")+(d.disabled?" disabled":"")+'"><span class="old"/></div>').parent().parent();d.$active=c('<span class="selected">'+d.selected.title+"</span>").appendTo(d.$container);d.$carat=c('<span class="carat"/>').appendTo(d.$container);d.$scrollWrapper=c("<div><ul/></div>").appendTo(d.$container);d.$dropDown=d.$scrollWrapper.find("ul");d.$form=d.$container.closest("form");c.each(d.options,function(){d.$dropDown.append("<li"+(this.selected?' class="active"':"")+">"+this.title+"</li>")});d.$items=d.$dropDown.find("li");d.cutOff&&d.$items.length>d.cutOff&&d.$container.addClass("scrollable");d.getMaxHeight();d.isTouch&&d.nativeTouch?d.bindTouchHandlers():d.bindHandlers()},getMaxHeight:function(){for(i=this.maxHeight=0;i<this.$items.length;i++){var d=this.$items.eq(i);this.maxHeight+=d.outerHeight();if(this.cutOff==i+1){break}}},bindTouchHandlers:function(){var d=this;d.$container.on("click.easyDropDown",function(){d.$select.focus()});d.$select.on({change:function(){var f=c(this).find("option:selected"),e=f.text(),f=f.val();d.$active.text(e);"function"===typeof d.onChange&&d.onChange.call(d.$select[0],{title:e,value:f})},focus:function(){d.$container.addClass("focus")},blur:function(){d.$container.removeClass("focus")}})},bindHandlers:function(){var d=this;d.query="";d.$container.on({"click.easyDropDown":function(){d.down||d.disabled?d.close():d.open()},"mousemove.easyDropDown":function(){d.keyboardMode&&(d.keyboardMode=!1)}});c("body").on("click.easyDropDown."+d.id,function(f){f=c(f.target);var e=d.wrapperClass.split(" ").join(".");!f.closest("."+e).length&&d.down&&d.close()});d.$items.on({"click.easyDropDown":function(){var e=c(this).index();d.select(e);d.$select.focus()},"mouseover.easyDropDown":function(){if(!d.keyboardMode){var e=c(this);e.addClass("focus").siblings().removeClass("focus");d.focusIndex=e.index()}},"mouseout.easyDropDown":function(){d.keyboardMode||c(this).removeClass("focus")}});d.$select.on({"focus.easyDropDown":function(){d.$container.addClass("focus");d.inFocus=!0},"blur.easyDropDown":function(){d.$container.removeClass("focus");d.inFocus=!1},"keydown.easyDropDown":function(f){if(d.inFocus){d.keyboardMode=!0;var e=f.keyCode;if(38==e||40==e||32==e){f.preventDefault(),38==e?(d.focusIndex--,d.focusIndex=0>d.focusIndex?d.$items.length-1:d.focusIndex):40==e&&(d.focusIndex++,d.focusIndex=d.focusIndex>d.$items.length-1?0:d.focusIndex),d.down||d.open(),d.$items.removeClass("focus").eq(d.focusIndex).addClass("focus"),d.cutOff&&d.scrollToView(),d.query=""}if(d.down){if(9==e||27==e){d.close()}else{if(13==e){return f.preventDefault(),d.select(d.focusIndex),d.close(),!1}if(8==e){return f.preventDefault(),d.query=d.query.slice(0,-1),d.search(),clearTimeout(d.resetQuery),!1}38!=e&&40!=e&&(f=String.fromCharCode(e),d.query+=f,d.search(),clearTimeout(d.resetQuery))}}}},"keyup.easyDropDown":function(){d.resetQuery=setTimeout(function(){d.query=""},1200)}});d.$dropDown.on("scroll.easyDropDown",function(e){d.$dropDown[0].scrollTop>=d.$dropDown[0].scrollHeight-d.maxHeight?d.$container.addClass("bottom"):d.$container.removeClass("bottom")});if(d.$form.length){d.$form.on("reset.easyDropDown",function(){d.$active.text(d.hasLabel?d.label:d.options[0].title)})}},unbindHandlers:function(){this.$container.add(this.$select).add(this.$items).add(this.$form).add(this.$dropDown).off(".easyDropDown");c("body").off("."+this.id)},open:function(){var e=window.scrollY||document.documentElement.scrollTop,f=window.scrollX||document.documentElement.scrollLeft,d=this.notInViewport(e);this.closeAll();this.getMaxHeight();this.$select.focus();window.scrollTo(f,e+d);this.$container.addClass("open");this.$scrollWrapper.css("height",this.maxHeight+"px");this.down=!0},close:function(){this.$container.removeClass("open");this.$scrollWrapper.css("height","0px");this.focusIndex=this.selected.index;this.query="";this.down=!1},closeAll:function(){var d=Object.getPrototypeOf(this).instances,e;for(e in d){d[e].close()}},select:function(e){"string"===typeof e&&(e=this.$select.find("option[value="+e+"]").index()-1);var f=this.options[e],d=this.hasLabel?e+1:e;this.$items.removeClass("active").eq(e).addClass("active");this.$active.text(f.title);this.$select.find("option").removeAttr("selected").eq(d).prop("selected",!0).parent().trigger("change");this.selected={index:e,title:f.title};this.focusIndex=i;"function"===typeof this.onChange&&this.onChange.call(this.$select[0],{title:f.title,value:f.value})},search:function(){var e=this,f=function(g){e.focusIndex=g;e.$items.removeClass("focus").eq(e.focusIndex).addClass("focus");e.scrollToView()};for(i=0;i<e.options.length;i++){var d=e.options[i].title.toUpperCase();if(0==d.indexOf(e.query)){f(i);return}}for(i=0;i<e.options.length;i++){if(d=e.options[i].title.toUpperCase(),-1<d.indexOf(e.query)){f(i);break}}},scrollToView:function(){if(this.focusIndex>=this.cutOff){var d=this.$items.eq(this.focusIndex).outerHeight()*(this.focusIndex+1)-this.maxHeight;this.$dropDown.scrollTop(d)}},notInViewport:function(e){var f=e+(window.innerHeight||document.documentElement.clientHeight),d=this.$dropDown.offset().top+this.maxHeight;return d>=e&&d<=f?0:d-f+5},destroy:function(){this.unbindHandlers();this.$select.unwrap().siblings().remove();this.$select.unwrap();delete Object.getPrototypeOf(this).instances[this.$select[0].id]},disable:function(){this.disabled=!0;this.$container.addClass("disabled");this.$select.attr("disabled",!0);this.down||this.close()},enable:function(){this.disabled=!1;this.$container.removeClass("disabled");this.$select.attr("disabled",!1)}};var a=function(e,f){e.id=e.id?e.id:"EasyDropDown"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6).toUpperCase();var d=new b;d.instances[e.id]||(d.instances[e.id]=d,d.init(e,f))};c.fn.easyDropDown=function(){var e=arguments,f=[],d;d=this.each(function(){if(e&&"string"===typeof e[0]){var g=b.prototype.instances[this.id][e[0]](e[1],e[2]);g&&f.push(g)}else{a(this,e[0])}});return f.length?1<f.length?f:f[0]:d};c(function(){"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(d){return d.__proto__}:function(d){return d.constructor.prototype});c("select.dropdown").each(function(){var d=c(this).attr("data-settings");settings=d?c.parseJSON(d):{};a(this,settings)})})})(jQuery);